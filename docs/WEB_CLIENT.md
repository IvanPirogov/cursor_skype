# Веб-клиент мессенджера

## Обзор

Веб-клиент представляет собой современное одностраничное приложение (SPA) для мессенджера, построенное на чистом JavaScript с использованием современных веб-технологий.

## Структура проекта

```
web/
├── index.html              # Главная страница (логин/регистрация)
├── chat.html               # Страница чата
└── static/
    ├── css/
    │   ├── common.css      # Общие стили
    │   ├── auth.css        # Стили аутентификации
    │   └── chat.css        # Стили чата
    ├── js/
    │   ├── api.js          # API клиент
    │   ├── auth.js         # Управление аутентификацией
    │   ├── chat.js         # Основной контроллер чата
    │   ├── websocket.js    # WebSocket клиент
    │   └── notifications.js # Система уведомлений
    └── images/
        └── (статические изображения)
```

## Компоненты

### 1. Система аутентификации (`auth.js`)

**Функции:**
- Переключение между формами входа и регистрации
- Валидация форм в реальном времени
- Отправка данных на сервер
- Сохранение JWT токена
- Автоматическое перенаправление

**Основные методы:**
- `handleLogin()` - обработка входа
- `handleRegister()` - обработка регистрации
- `validateField()` - валидация полей
- `checkAuthStatus()` - проверка статуса аутентификации

### 2. API клиент (`api.js`)

**Функции:**
- Централизованное управление HTTP запросами
- Автоматическое добавление JWT токена
- Обработка ошибок
- Методы для всех API endpoints

**Основные методы:**
- `request()` - базовый HTTP запрос
- `login()`, `register()` - аутентификация
- `getChats()`, `createChat()` - управление чатами
- `sendMessage()`, `getMessages()` - сообщения
- `uploadFile()` - загрузка файлов

### 3. WebSocket клиент (`websocket.js`)

**Функции:**
- Real-time соединение с сервером
- Автоматическое переподключение
- Обработка различных типов сообщений
- Система событий

**Основные методы:**
- `connect()` - подключение к серверу
- `send()` - отправка сообщений
- `sendChatMessage()` - отправка чат-сообщения
- `sendTypingIndicator()` - индикатор печати
- `on()`, `off()`, `emit()` - система событий

### 4. Контроллер чата (`chat.js`)

**Функции:**
- Управление интерфейсом чата
- Отображение сообщений
- Управление контактами
- Обработка файлов
- Модальные окна

**Основные методы:**
- `selectChat()` - выбор чата
- `sendMessage()` - отправка сообщения
- `handleNewMessage()` - обработка новых сообщений
- `handleFileUpload()` - загрузка файлов
- `createNewChat()` - создание нового чата

### 5. Система уведомлений (`notifications.js`)

**Функции:**
- Показ уведомлений пользователю
- Автоматическое скрытие
- Различные типы уведомлений
- Анимации

**Основные методы:**
- `show()` - показать уведомление
- `success()`, `error()`, `warning()`, `info()` - типы уведомлений
- `hide()` - скрыть уведомление
- `clear()` - очистить все уведомления

## Функциональность

### Аутентификация
- Вход в систему
- Регистрация пользователя
- Валидация форм
- Сохранение сессии
- Автоматическое перенаправление

### Чат
- Список чатов
- Отправка сообщений
- Получение сообщений в real-time
- Индикатор печати
- Загрузка файлов
- Создание новых чатов

### Контакты
- Список контактов
- Добавление контактов
- Поиск контактов
- Статус онлайн

### Файлы
- Загрузка изображений
- Загрузка документов
- Превью изображений
- Информация о файлах

## Стили

### Цветовая схема
- Основной цвет: `#007bff`
- Успех: `#28a745`
- Ошибка: `#dc3545`
- Предупреждение: `#ffc107`
- Информация: `#17a2b8`

### Адаптивность
- Полная поддержка мобильных устройств
- Отзывчивый дизайн
- Адаптивная навигация
- Оптимизация для touch устройств

## Безопасность

### Аутентификация
- JWT токены
- Автоматическое истечение сессии
- Проверка токенов при каждом запросе
- Безопасное хранение в localStorage

### Валидация
- Валидация на клиенте
- Валидация на сервере
- Защита от XSS
- Экранирование HTML

## Производительность

### Оптимизации
- Ленивая загрузка сообщений
- Кэширование данных
- Минимизация DOM операций
- Эффективная обработка событий

### WebSocket
- Автоматическое переподключение
- Очередь сообщений
- Обработка потери соединения
- Heartbeat пинги

## Использование

### Запуск
1. Убедитесь, что backend сервер запущен
2. Откройте браузер и перейдите на `http://localhost:8080`
3. Зарегистрируйтесь или войдите в систему
4. Начните общение

### Разработка
1. Внесите изменения в файлы в папке `web/static/`
2. Обновите страницу в браузере
3. Используйте Developer Tools для отладки

## Браузерная совместимость

### Поддерживаемые браузеры
- Chrome 60+
- Firefox 55+
- Safari 12+
- Edge 79+

### Используемые технологии
- ES6+ JavaScript
- CSS Grid и Flexbox
- WebSocket API
- Fetch API
- LocalStorage API
- File API

## Структура сообщений WebSocket

### Отправка сообщения
```javascript
{
  type: 'chat',
  data: {
    chat_id: 123,
    content: 'Hello, world!',
    message_type: 'text'
  },
  timestamp: 1640995200000
}
```

### Получение сообщения
```javascript
{
  type: 'new_message',
  data: {
    id: 456,
    chat_id: 123,
    content: 'Hello, world!',
    sender_name: 'John Doe',
    created_at: '2021-12-31T12:00:00Z'
  },
  user_id: 789,
  timestamp: 1640995200000
}
```

## Расширение функциональности

### Добавление новых компонентов
1. Создайте новый JS файл в `web/static/js/`
2. Добавьте соответствующие стили в CSS
3. Подключите к HTML странице
4. Интегрируйте с существующими компонентами

### Кастомизация интерфейса
1. Модифицируйте CSS переменные
2. Обновите цветовую схему
3. Измените шрифты и размеры
4. Добавьте анимации

## Отладка

### Логирование
- Все ошибки логируются в консоль
- WebSocket события отслеживаются
- API запросы показывают статус

### Инструменты разработки
- Chrome DevTools
- Network tab для отладки API
- Console для JavaScript ошибок
- Application tab для localStorage

## Развертывание

### Продакшн
1. Минифицируйте CSS и JS файлы
2. Оптимизируйте изображения
3. Настройте gzip сжатие
4. Используйте CDN для статических файлов

### Кэширование
- Настройте правильные Cache-Control заголовки
- Используйте версионирование файлов
- Настройте Service Worker для офлайн работы