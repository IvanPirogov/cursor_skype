# Messenger Desktop

Кросс-платформенный десктопный клиент мессенджера на Electron.

## Возможности

- ✅ **Кросс-платформенность** - Windows, macOS, Linux
- ✅ **Нативный интерфейс** - адаптированный под каждую ОС
- ✅ **Системные уведомления** - интеграция с системой уведомлений
- ✅ **Системный трей** - сворачивание в трей
- ✅ **Автозапуск** - запуск при старте системы
- ✅ **Горячие клавиши** - быстрый доступ к функциям
- ✅ **Автообновления** - автоматическое обновление приложения
- ✅ **Темная тема** - автоматическое переключение по системе
- ✅ **Файловые диалоги** - нативные диалоги для работы с файлами
- ✅ **Масштабирование** - изменение размера интерфейса
- ✅ **Контекстные меню** - дополнительные возможности
- ✅ **Оффлайн работа** - кэширование данных

## Технические требования

### Системные требования

- **Windows:** Windows 10 или выше
- **macOS:** macOS 10.14 или выше
- **Linux:** Ubuntu 18.04, Fedora 32, Debian 10 или эквивалент

### Для разработки

- **Node.js:** 16.0.0 или выше
- **npm:** 8.0.0 или выше
- **Git:** для клонирования репозитория

## Установка

### Из релизов (рекомендуется)

1. Перейдите на [страницу релизов](https://github.com/messenger/desktop/releases)
2. Скачайте подходящий файл для вашей ОС:
   - **Windows:** `Messenger-Setup-1.0.0.exe`
   - **macOS:** `Messenger-1.0.0.dmg`
   - **Linux:** `Messenger-1.0.0.AppImage` или `messenger_1.0.0_amd64.deb`

### Из исходного кода

```bash
# Клонирование репозитория
git clone https://github.com/messenger/messenger.git
cd messenger/desktop

# Установка зависимостей
npm install

# Запуск в режиме разработки
npm run dev

# Сборка для текущей платформы
npm run build
```

## Использование

### Первый запуск

1. Запустите приложение
2. Войдите в свою учетную запись или зарегистрируйтесь
3. Начните общение!

### Горячие клавиши

| Действие | Windows/Linux | macOS |
|----------|---------------|-------|
| Новый чат | `Ctrl+N` | `Cmd+N` |
| Настройки | `Ctrl+,` | `Cmd+,` |
| Поиск | `Ctrl+F` | `Cmd+F` |
| Перезагрузка | `Ctrl+R` | `Cmd+R` |
| Полноэкранный режим | `F11` | `Ctrl+Cmd+F` |
| Увеличить масштаб | `Ctrl++` | `Cmd++` |
| Уменьшить масштаб | `Ctrl+-` | `Cmd+-` |
| Сбросить масштаб | `Ctrl+0` | `Cmd+0` |
| DevTools | `Ctrl+Shift+I` | `Alt+Cmd+I` |

### Контекстные меню

**Сообщения (правый клик):**
- Копировать
- Ответить
- Переслать
- Удалить

**Чаты (правый клик):**
- Открыть чат
- Закрепить
- Архивировать
- Удалить

### Системный трей

Приложение может сворачиваться в системный трей:

- **Левый клик:** показать/скрыть окно
- **Правый клик:** контекстное меню
- **Двойной клик:** показать окно

## Настройки

### Основные настройки

- **Тема:** Системная / Светлая / Темная
- **Автозапуск:** Запуск при старте системы
- **Сворачивание в трей:** Минимизация в трей
- **Закрытие в трей:** Скрытие при закрытии

### Уведомления

- **Системные уведомления:** Включить/выключить
- **Звуковые уведомления:** Включить/выключить
- **Счетчик в трее:** Показывать количество непрочитанных

### Продвинутые настройки

- **Масштабирование:** Изменение размера интерфейса
- **Сервер:** Настройка адреса сервера
- **Прокси:** Настройка прокси-сервера

## Разработка

### Структура проекта

```
desktop/
├── main.js                 # Главный процесс
├── preload.js              # Preload скрипт
├── package.json            # Конфигурация npm
├── src/                    # Исходный код
│   ├── index.html          # Основной HTML
│   ├── styles/             # CSS стили
│   │   ├── main.css
│   │   ├── auth.css
│   │   ├── chat.css
│   │   ├── settings.css
│   │   └── desktop.css
│   └── js/                 # JavaScript файлы
│       ├── main.js
│       ├── auth.js
│       ├── chat.js
│       ├── settings.js
│       ├── api.js
│       ├── websocket.js
│       ├── notifications.js
│       └── desktop.js
├── assets/                 # Ресурсы
│   ├── icon.png
│   ├── icon.ico
│   ├── icon.icns
│   └── tray-icon.png
└── build/                  # Конфигурация сборки
```

### Команды разработки

```bash
# Установка зависимостей
npm install

# Запуск в режиме разработки
npm run dev

# Сборка для всех платформ
npm run build

# Сборка для конкретной платформы
npm run build-win    # Windows
npm run build-mac    # macOS
npm run build-linux  # Linux

# Упаковка без установщика
npm run pack

# Публикация релиза
npm run release
```

### Отладка

```bash
# Запуск с DevTools
npm run dev

# Просмотр логов главного процесса
npm run dev 2>&1 | grep "Main:"

# Просмотр логов renderer процесса
# Откройте DevTools в приложении (Ctrl+Shift+I)
```

### Добавление новых функций

1. **Добавление API методов:**
   - Обновите `preload.js` для безопасного доступа
   - Добавьте IPC обработчики в `main.js`

2. **Добавление UI элементов:**
   - Обновите `src/index.html`
   - Добавьте стили в соответствующий CSS файл
   - Добавьте JavaScript логику

3. **Добавление горячих клавиш:**
   - Обновите меню в `main.js`
   - Добавьте обработчики в `desktop.js`

## Сборка

### Локальная сборка

```bash
# Сборка для текущей платформы
npm run build

# Файлы появятся в директории dist/
```

### Сборка для всех платформ

```bash
# Требует настройки окружения для каждой платформы
npm run build-win
npm run build-mac
npm run build-linux
```

### Настройка CI/CD

Пример для GitHub Actions:

```yaml
name: Build and Release

on:
  push:
    tags: ['v*']

jobs:
  build:
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ubuntu-latest, windows-latest, macos-latest]
    
    steps:
    - uses: actions/checkout@v2
    - uses: actions/setup-node@v2
      with:
        node-version: '16'
    
    - run: npm ci
    - run: npm run build
    
    - uses: actions/upload-artifact@v2
      with:
        name: ${{ matrix.os }}
        path: dist/
```

## Автообновления

Приложение поддерживает автоматические обновления через `electron-updater`.

### Настройка

1. Опубликуйте релиз на GitHub
2. Приложение автоматически проверит обновления при запуске
3. Пользователь получит уведомление о доступном обновлении

### Ручная проверка

```javascript
// В renderer процессе
window.electronAPI.checkForUpdates();
```

## Безопасность

### Реализованные меры

- **Context Isolation:** Изоляция контекста для безопасности
- **Preload Scripts:** Безопасный доступ к Node.js API
- **CSP Headers:** Защита от XSS атак
- **Secure Transport:** Только HTTPS соединения в production

### Рекомендации

- Регулярно обновляйте Electron
- Используйте только проверенные npm пакеты
- Валидируйте все входные данные
- Не выполняйте недоверенный код

## Производительность

### Оптимизации

- **Lazy Loading:** Загрузка модулей по требованию
- **Виртуализация списков:** Для больших списков сообщений
- **Кэширование:** Кэширование данных и изображений
- **Дебаунсинг:** Оптимизация частых операций

### Мониторинг

```javascript
// Отслеживание использования памяти
process.memoryUsage();

// Отслеживание производительности
console.time('operation');
// ... код ...
console.timeEnd('operation');
```

## Troubleshooting

### Частые проблемы

1. **Приложение не запускается**
   - Проверьте версию Node.js
   - Переустановите зависимости: `npm ci`
   - Проверьте права доступа к файлам

2. **Белый экран при запуске**
   - Проверьте Console в DevTools
   - Убедитесь, что файлы CSS и JS загружаются
   - Проверьте пути к файлам

3. **Уведомления не работают**
   - Проверьте разрешения системы
   - Убедитесь, что уведомления включены в настройках
   - Проверьте поддержку в ОС

4. **Автообновления не работают**
   - Проверьте подключение к интернету
   - Убедитесь, что релиз опубликован
   - Проверьте настройки файрвола

### Логи

```bash
# Расположение логов
Windows: %USERPROFILE%\AppData\Roaming\Messenger\logs\
macOS: ~/Library/Logs/Messenger/
Linux: ~/.config/Messenger/logs/
```

### Сброс настроек

```bash
# Удалите папку с пользовательскими данными
Windows: %USERPROFILE%\AppData\Roaming\Messenger\
macOS: ~/Library/Application Support/Messenger/
Linux: ~/.config/Messenger/
```

## Участие в разработке

1. Форкните репозиторий
2. Создайте ветку для функции: `git checkout -b feature/amazing-feature`
3. Сделайте коммит: `git commit -m 'Add amazing feature'`
4. Отправьте изменения: `git push origin feature/amazing-feature`
5. Создайте Pull Request

## Лицензия

MIT License - см. файл [LICENSE](LICENSE).

## Поддержка

- **GitHub Issues:** [Создать issue](https://github.com/messenger/desktop/issues)
- **Документация:** [Wiki](https://github.com/messenger/desktop/wiki)
- **Чат:** [Discord](https://discord.gg/messenger)

---

**Версия:** 1.0.0  
**Дата:** 2024-01-15  
**Автор:** Messenger Team